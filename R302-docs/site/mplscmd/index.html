
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.4.2, mkdocs-material-8.5.7" name="generator"/>
<title>Mplscmd - BUT R302 Réseaux d'opérateurs</title>
<link href="../assets/stylesheets/main.20d9efc8.min.css" rel="stylesheet"/>
<link href="../assets/stylesheets/palette.cbb835fc.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<script src="../js/unpkg.com/d3@6.7.0/dist/d3.min.js" type="text/javascript"></script><script src="../js/unpkg.com/markmap-lib@0.14.1/dist/browser/index.min.js" type="text/javascript"></script><script src="../js/unpkg.com/markmap-view@0.14.0/dist/index.min.js" type="text/javascript"></script><style type="text/css">div.mkdocs-markmap {
    width: 100%;
    min-height: 1em;
    border: 1px solid grey;
}
.mkdocs-markmap > svg {
    width: 100%;
    height: 100%;
    display: block;
}
</style></head>
<body data-md-color-accent="none" data-md-color-primary="none" data-md-color-scheme="" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#commandes-cisco">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="BUT R302 Réseaux d'opérateurs" class="md-header__button md-logo" data-md-component="logo" href=".." title="BUT R302 Réseaux d'opérateurs">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            BUT R302 Réseaux d'opérateurs
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Mplscmd
            
          </span>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="BUT R302 Réseaux d'opérateurs" class="md-nav__button md-logo" data-md-component="logo" href=".." title="BUT R302 Réseaux d'opérateurs">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
    BUT R302 Réseaux d'opérateurs
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="..">
        Généralités BGP (texte)
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../g%C3%A9n%C3%A9ralit%C3%A9s.mm/">
        Généralités BGP (mindmap)
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../bgp_cmd.html">
        Commandes BGP (mindmap)
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../commandes_aplat.mm/">
        Commandes BGP (texte)
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../mplsmm/">
        Généralités MPLS (mindmap)
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../mpls_aplat.mm/">
        Généralités MPLS (texte)
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../mpls_cmd.html">
        Commandes MPLS (mindmap)
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../mpls_cmd_aplat.mm/">
        Commandes MPLS (texte)
      </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#mpls-config">
    mpls config
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#configuration-dun-pe-ler-l3vpn">
    Configuration d'un PE (=LER) L3VPN
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#debug-mpls">
    Debug mpls
  </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<p>Configurations MPLS</p>
<div class="mkdocs-markmap" data-markdown="---&amp;#10;&amp;#10;markmap:&amp;#10;&amp;#10;  colorFreezeLevel: 2&amp;#10;&amp;#10;  maxWidth: 800&amp;#10;&amp;#10;---&amp;#10;&amp;#10;# Commandes Linux (AS+LABEL)&amp;#10;&amp;#10;&amp;#10;&amp;#10;- mtr&amp;#10;&amp;#10;```bash&amp;#10;&amp;#10;  mtr --tcp --port 443 --show-ips --mpls --aslookup --curses www.umontpellier.fr&amp;#10;&amp;#10;  mtr -P 443 -T  -b -e -z -t 194.199.227.220&amp;#10;&amp;#10;  mtr  -P 443 -T -c 2  -b -e -z -t -j 194.199.227.220 | from json|flatten|get hubs|flatten&amp;#10;&amp;#10;"><svg class="markmap" id="markmap-0"></svg></div>
<ul>
<li>traceroute</li>
</ul>
<pre><code class="language-bash">
traceroute -A -n -e -i eth0 8.8.8.8

</code></pre>
<h1 id="commandes-cisco">Commandes Cisco</h1>
<h2 id="mpls-config">mpls config</h2>
<ul>
<li>``` ios</li>
</ul>
<p># cef améliore les performances de MPLS(distributed c'est mieux) </p>
<p>conf t</p>
<pre><code> ip cef distributed
</code></pre>
<p>```</p>
<ul>
<li>AutoConfig LDP</li>
</ul>
<p>```ios</p>
<p>router ospf 1</p>
<pre><code>  mpls ldp autoconfig
</code></pre>
<p>```</p>
<ul>
<li>Déclarer l'usage de MPLS sur une interface</li>
</ul>
<pre><code class="language-ios">
  interface FastEthernet2/0

         mpls ip



  ```



## Configuration d'un provider (=LSR) L3VPN



```ios

interface Loopback2

 ip address 2.2.2.2 255.255.255.255

!

interface FastEthernet0/0

 ip address 10.0.12.2 255.255.255.252

 duplex auto

 speed auto

 mpls ip

!

interface FastEthernet1/0

 ip address 10.0.23.2 255.255.255.252

 duplex auto

 speed auto

 mpls ip

!

interface FastEthernet2/0

 ip address 10.0.24.2 255.255.255.252

 duplex auto

 speed auto

 mpls ip

!

router ospf 1

 router-id 2.2.2.2

 log-adjacency-changes

 network 2.2.2.0 0.0.0.255 area 0

 network 10.0.12.0 0.0.0.3 area 0

 network 10.0.23.0 0.0.0.3 area 0

 network 10.0.24.0 0.0.0.3 area 0

 network 0.0.0.0 255.255.255.255 area 0

!

</code></pre>
<h2 id="configuration-dun-pe-ler-l3vpn">Configuration d'un PE (=LER) L3VPN</h2>
<pre><code class="language-ios">
interface Loopback3

 ip address 3.3.3.3 255.255.255.255

!

interface FastEthernet0/0

 ip address 10.0.23.1 255.255.255.252

 duplex auto

 speed auto

 mpls ip

!

interface FastEthernet1/0

 ip vrf forwarding custA

 ip address 192.168.3.3 255.255.255.0

 duplex auto

 speed auto

!         

interface FastEthernet2/0

 ip vrf forwarding custC

 ip address 192.168.3.3 255.255.255.0

 duplex auto

 speed auto

!

router eigrp 1

 no auto-summary

 !

 address-family ipv4 vrf custA

  redistribute bgp 200

  network 3.3.3.0 0.0.0.255

  network 192.168.3.0

  default-metric 10000 100 255 1 1500

  auto-summary

  autonomous-system 10

 exit-address-family

!

router ospf 2 vrf custC

 log-adjacency-changes

 redistribute bgp 200 metric 200 subnets

 network 3.3.3.0 0.0.0.255 area 0

 network 192.168.3.0 0.0.0.255 area 0

!

router ospf 1

 router-id 3.3.3.3

 log-adjacency-changes

 network 3.3.3.0 0.0.0.255 area 0

 network 10.0.23.0 0.0.0.3 area 0

!

router bgp 200

 no bgp default ipv4-unicast

 bgp log-neighbor-changes

 neighbor 1.1.1.1 remote-as 200

 neighbor 1.1.1.1 update-source Loopback3

 neighbor 4.4.4.4 remote-as 200

 neighbor 4.4.4.4 update-source Loopback3

 !

 address-family ipv4

  neighbor 1.1.1.1 activate

  neighbor 4.4.4.4 activate

  no auto-summary

  no synchronization

 exit-address-family

 !

 address-family vpnv4

  neighbor 1.1.1.1 activate

  neighbor 1.1.1.1 send-community extended

  neighbor 4.4.4.4 activate

  neighbor 4.4.4.4 send-community extended

 exit-address-family

 !

 address-family ipv4 vrf custC

  redistribute ospf 2 vrf custC

  no synchronization

 exit-address-family

 !

 address-family ipv4 vrf custA

  redistribute eigrp 10

  no synchronization

 exit-address-family

!

</code></pre>
<h2 id="debug-mpls">Debug mpls</h2>
<pre><code class="language-ios">
  sh mpls forwarding-table  

  Local  Outgoing    Prefix            Bytes tag  Outgoing   Next Hop    

  tag    tag or VC   or Tunnel Id      switched   interface              

  16     Pop tag     10.0.24.0/30      0          Fa2/0      10.0.12.2    

  17     Pop tag     10.0.23.0/30      0          Fa2/0      10.0.12.2    

  18     Pop tag     2.2.2.2/32        0          Fa2/0      10.0.12.2    

  19     16          3.3.3.3/32        0          Fa2/0      10.0.12.2    

  20     17          4.4.4.4/32        0          Fa2/0      10.0.12.2    

  21     Untagged    5.0.0.0/8[V]      0          Fa1/0      192.168.1.5  

  22     Aggregate   192.168.1.0/24[V] 0                                  

  23     Untagged    6.0.0.0/8[V]      0          Fa3/0      192.168.1.6  

  24     Aggregate   192.168.1.0/24[V] 0                                  

  25     Untagged    11.11.11.11/32[V] 0          Fa0/0      192.168.1.11 

  26     Aggregate   192.168.1.0/24[V] 0    

</code></pre>
<pre><code class="language-ios">
show tag-switching tdp neighbor 

  Peer LDP Ident: 2.2.2.2:0; Local LDP Ident 1.1.1.1:0

    TCP connection: 2.2.2.2.62837 - 1.1.1.1.646

    State: Oper; Msgs sent/rcvd: 141/142; Downstream

    Up time: 01:55:58

    LDP discovery sources:

     FastEthernet2/0, Src IP addr: 10.0.12.2

        Addresses bound to peer LDP Ident:

          10.0.12.2       2.2.2.2         10.0.23.2       10.0.24.2     

  ```



```ios

sh bgp vpnv4 unicast all summary 

  BGP router identifier 1.1.1.1, local AS number 200

  BGP table version is 33, main routing table version 33

  15 network entries using 2055 bytes of memory

  20 path entries using 1360 bytes of memory

  17/14 BGP path/bestpath attribute entries using 2108 bytes of memory

  7 BGP extended community entries using 360 bytes of memory

  0 BGP route-map cache entries using 0 bytes of memory

  0 BGP filter-list cache entries using 0 bytes of memory

  BGP using 5883 total bytes of memory

  BGP activity 15/0 prefixes, 22/2 paths, scan interval 15 secs



  Neighbor        V    AS MsgRcvd MsgSent   TblVer  InQ OutQ Up/Down  State/PfxRcd

  3.3.3.3         4   200      71      73       33    0    0  00:58:42        7

  4.4.4.4         4   200      71      74       33    0    0  00:58:39        7



</code></pre>
<p>### Vérifiez la correspondance label-fec</p>
<p>```ios</p>
<p>R1#show tag-switching tdp neighbor </p>
<pre><code>Peer LDP Ident: 2.2.2.2:0; Local LDP Ident 1.1.1.1:0

 TCP connection: 2.2.2.2.62837 - 1.1.1.1.646

 State: Oper; Msgs sent/rcvd: 141/142; Downstream

 Up time: 01:55:58

LDP discovery sources:

 FastEthernet2/0, Src IP addr: 10.0.12.2

    Addresses bound to peer LDP Ident:

      10.0.12.2       2.2.2.2         10.0.23.2       10.0.24.2
</code></pre>
<pre><code>


### Vérifiez la forwarding table

```ios



show tag-switching forwarding-table 

  Local  Outgoing    Prefix            Bytes tag  Outgoing   Next Hop    

  tag    tag or VC   or Tunnel Id      switched   interface              

  16     Pop tag     10.0.24.0/30      0          Fa0/0      10.0.23.2    

  17     Pop tag     2.2.2.2/32        0          Fa0/0      10.0.23.2    

  18     17          4.4.4.4/32        0          Fa0/0      10.0.23.2    

  19     Pop tag     10.0.12.0/30      0          Fa0/0      10.0.23.2    

  20     18          1.1.1.1/32        0          Fa0/0      10.0.23.2    

  21     Untagged    7.0.0.0/8[V]      0          Fa1/0      192.168.3.7  

  22     Aggregate   192.168.3.0/24[V] 0                                  

  23     Untagged    9.9.9.9/32[V]     0          Fa2/0      192.168.3.9  

  24     Untagged    10.10.10.10/32[V] 0          Fa2/0      192.168.3.9  

  25     Aggregate   192.168.3.0/24[V] 0                                  

  26     Untagged    192.168.4.0/24[V] 0          Fa2/0      192.168.3.9  

  27     Untagged    192.168.90.0/24[V]0          Fa2/0      192.168.3.9     

  ```
</code></pre>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
<script src="../assets/javascripts/bundle.8492ddcf.min.js"></script>
<script type="text/javascript">(function initializeMarkmap() {
    function update_markmaps() {
        const markmap_transformer = new markmap.Transformer();
        const markmaps = document.getElementsByClassName('mkdocs-markmap');
        var el, content, svg, root, m;
        for (var i = 0; i < markmaps.length; i++) {
            el = markmaps[i];
            content = el.getAttribute('data-markdown').replaceAll('&#10;', '\n');
            svg = el.querySelector('svg');
            root = markmap_transformer.transform(content).root;
            m = markmap.Markmap.create(svg, null, root);

            (function(obj, e, r) {
                obj.rescale(1).then(function() {
                    e.parentElement.style.height = (e.getBBox().height + 10) + "px";
                    requestAnimationFrame(() => { obj.fit(); })
                });
            })(m, svg, root);
        }
    }

    var MutationObserver = window.MutationObserver || window.WebKitMutationObserver;
    var observer = new MutationObserver(function(mutations) {
        update_markmaps();
    });

    var target = document.getElementById('mkdocs-decrypted-content');
    if (undefined != target) {
        observer.observe(target, { childList: true });
    }

    update_markmaps();
})();
</script></body>
</html>