
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-8.5.7">
    
    
      
        <title>Généralités BGP (mindmap) - BUT R302 Réseaux d'opérateurs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.20d9efc8.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#bpg" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="BUT R302 Réseaux d&#39;opérateurs" class="md-header__button md-logo" aria-label="BUT R302 Réseaux d'opérateurs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            BUT R302 Réseaux d'opérateurs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Généralités BGP (mindmap)
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="BUT R302 Réseaux d&#39;opérateurs" class="md-nav__button md-logo" aria-label="BUT R302 Réseaux d'opérateurs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    BUT R302 Réseaux d'opérateurs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Généralités BGP (texte)
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Généralités BGP (mindmap)
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Généralités BGP (mindmap)
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#definitions" class="md-nav__link">
    Définitions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#relations-entre-as" class="md-nav__link">
    Relations entre AS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#caracteristiques-de-bgp" class="md-nav__link">
    Caractéristiques de BGP
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sessions" class="md-nav__link">
    Sessions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mp-bgp-multiprotocol-bgp" class="md-nav__link">
    MP-BGP (multiprotocol BGP)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#as-number-asn" class="md-nav__link">
    AS Number (ASN)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#messages-bgp-echanges-sur-le-port-tcp-179" class="md-nav__link">
    Messages BGP échangés sur le port tcp 179
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#les-differents-etats-de-la-relation-entre-deux-voisins-bgp-neighbor-state" class="md-nav__link">
    les différents états de la relation entre deux voisins BGP ("neighbor state")
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#interet-de-lagregation-de-prefixes-avec-bgp" class="md-nav__link">
    Intérêt de l'agrégation de préfixes avec BGP
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rfc" class="md-nav__link">
    RFC
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../bgp_cmd.html" class="md-nav__link">
        Commandes BGP (mindmap)
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../commandes_aplat.mm/" class="md-nav__link">
        Commandes BGP (texte)
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../mplsmm/" class="md-nav__link">
        Généralités MPLS (mindmap)
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../mpls_aplat.mm/" class="md-nav__link">
        Généralités MPLS (texte)
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../mpls_cmd.html" class="md-nav__link">
        Commandes MPLS (mindmap)
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../mpls_cmd_aplat.mm/" class="md-nav__link">
        Commandes MPLS (texte)
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#definitions" class="md-nav__link">
    Définitions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#relations-entre-as" class="md-nav__link">
    Relations entre AS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#caracteristiques-de-bgp" class="md-nav__link">
    Caractéristiques de BGP
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sessions" class="md-nav__link">
    Sessions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mp-bgp-multiprotocol-bgp" class="md-nav__link">
    MP-BGP (multiprotocol BGP)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#as-number-asn" class="md-nav__link">
    AS Number (ASN)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#messages-bgp-echanges-sur-le-port-tcp-179" class="md-nav__link">
    Messages BGP échangés sur le port tcp 179
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#les-differents-etats-de-la-relation-entre-deux-voisins-bgp-neighbor-state" class="md-nav__link">
    les différents états de la relation entre deux voisins BGP ("neighbor state")
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#interet-de-lagregation-de-prefixes-avec-bgp" class="md-nav__link">
    Intérêt de l'agrégation de préfixes avec BGP
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rfc" class="md-nav__link">
    RFC
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="bpg">BPG</h1>
<h2 id="definitions">Définitions</h2>
<ul>
<li>Un "Autonomous System" est un ensemble de réseaux gérés par une seule entité. Par exemple "RENATER" qui fédère les réseaux des universités françaises.</li>
<li>
<p>Un ISP est une entreprise dont le métier est de connecter d'autres entreprises à l'internet.</p>
<ul>
<li>Les "ISP" de tiers 1 structurent l'internet.</li>
<li>Les "tiers 2" vendent et achètent du transit.</li>
<li>Les "tiers 3" ne fournissent pas de transit. Ils peuvent être "multi-homés"(deux chemins ou plus vers l'internet) afin d'assurer la haute disponibilité des accès et avoir les chemins les plus rapides vers une ressource prisée comme un "GAFAM".</li>
</ul>
</li>
<li>
<p>Les points d'échanges sont des lieux physiques où s'interconnectent les "ISP" afin de faciliter les échanges de données (France XI par exemple).</p>
</li>
<li>Un "Point Of Presence" ("POP") est un lieu physique permettant l'échange de données pour l'internet avec des entités locales.</li>
</ul>
<h2 id="relations-entre-as">Relations entre AS</h2>
<ul>
<li>Le "transit" est le service vendu par un "ISP" (Internet Service Provider) pour donner accès à Internet.</li>
<li>Un "peer" est un routeur d'un autre AS avec lequel on établit une relation de "peering".</li>
<li>Le "peering" est l’échange réciproque de flux souvent dans un but économique (voir <a href="https://www.peeringdb.com/net/433">https://www.peeringdb.com/net/433</a> comme exemple).</li>
<li>Un "peering" n'est pas transitif : ce n'est pas parce que A à un "peer" avec B et avec C que C a un "peer" avec B.</li>
<li>Un "peering" ne donne pas accès à tous les réseaux de l'"AS" auquel on est connecté.</li>
</ul>
<h2 id="caracteristiques-de-bgp">Caractéristiques de BGP</h2>
<ul>
<li>La métrique de BGP est de type "distance-vector" et correspond au nombre d'"AS" traversés. L'attribut de chemins "AS_PATH" qui contient les AS traversés permet (mais il n'est pas le seul critère) à BGP de choisir le meilleur chemin: c'est le plus court "AS-PATH" qui est retenu comme chemin.</li>
<li>BGP dispose d'un mécanisme de prévention des boucles : si un "AS_PATH" contient l'"AS" auquel appartient le routeur ce vecteur est mise de côté lors du choix de la meilleure route.</li>
<li>Il n'y a pas de paquets "Hello" pour l'auto-découverte des "peers" entre eux et donc il est nécessaire de déclarer l'IP du voisin pour communiquer.</li>
<li>Le temps de convergence de BGP est plus long que celui d'un IGP. En contrepartie, il gère des centaines de milliers de routes ce que ne peut faire un IGP.</li>
<li>Le port TCP 179 est utilisé pour les échanges entre routeurs BGP. </li>
<li>Le bit "don't fragment" est activé et est utilisé par le mécanisme de "Path MTU".</li>
<li>BGP a besoin d'un IGP pour partager les adresses internes à l'AS. Une route par défaut ne suffit pas.</li>
<li>Deux règles pour BGP :</li>
<li><strong>Principes de synchronisation</strong> : Les routes apprises via iBGP doivent être également dans la table de routage de votre IGP (OSPF,…) avant d’être annoncées à d’autres peers d’AS différents. Cette règle a pour but de ne pas accepter de transit qu'un routeur hors du réseau iBGP ne pourrait pas router conduisant à devenir un "black hole". Ce mécanisme ralentit la convergence. Les routeurs supportant dans leur immense majorité iBGP, la synchronisation est donc désactivée par défaut chez Cisco.</li>
<li>
<p><strong>Split-Horizon</strong>: une route apprise par une session iBGP n'est jamais transmise à un autre voisin iBGP afin d'éviter les boucles. On est donc obligé de faire du "full-mesh" entre tous les routeurs iBGP afin que ces routeurs iBGP se connaissent.</p>
</li>
<li>
<p>La table BGP est appelée "Loc-RIB table" (faire "show ip bgp") et est distincte de la RIB (faire "show ip route"). En conséquence,  il faut vérifier les deux tables : si la route exacte n'existe pas dans la "RIB BGP" ne transmettra pas la route à un autre AS </p>
</li>
<li>Les routes apprises dans iBGP sont redistribuées dans eBGP et vice-versa. Mais il n'y a pas de redistribution des routes d'un routeur iBGP vers un routeur iBGP.</li>
</ul>
<h2 id="sessions">Sessions</h2>
<ul>
<li>eBGP</li>
<li>C'est une session BGP entre deux routeurs appartenant à des AS différents.</li>
<li>Le TTL du paquet BGP est de 1 (le routeur averti doit être en frontal du nôtre et donc à une distance de 1 suffit et sécurise les échanges)</li>
<li>Le routeur averti vérifie que son AS n'est pas dans l'"AS_PATH" reçu. </li>
<li>Le routeur averti positionne le "NEXT-HOP" pour cette AS à l'IP source du routeur source établissant la connexion.</li>
<li>Le routeur averti ajoute son ASN dans l'"AS_PATH".</li>
<li>
<p>La distance administrative est de 20 pour BGP.</p>
</li>
<li>
<p>iBGP </p>
</li>
<li>Il est fait pour communiquer entre routeurs BGP dans un même AS (TTL des paquets à 255).</li>
<li>L'attribut AS_PATH n'est pas modifié par iBGP, il n'y a donc pas de détection possible des boucles avec iBGP.</li>
<li>Dans le cas d'un AS de transit les routeurs traversés qui n'implémentent qu'un IGP ne connaissent 
    pas les routes issues de BGP. Il faut donc soit des routes statiques, soit du "tunelling" MPLS, soit du fullmesh iBGP ("route reflector"), soit redistribuer les routes BGP dans l'IGP mais ...<ul>
<li>Il n'est pas conseiller de redistribuer les routes BGP dans l'IGP : il peut y avoir beaucoup de routes BGP...trop pour un IGP qui n'est pas taillé pour cela. Il n'y a pas non plus d'équivalence des métriques IGP ni de traductions possibles des attributs BGP dans le "langage" de l'IGP. </li>
<li>La redistribution des routes de l'IGP dans BGP n'est pas souhaitable non plus : il vaut mieux que tous les routeurs internes à l'AS supportent iBGP avec une topologie "full mesh" qui peut être facilitée par un "RR" (réflecteur de route).</li>
</ul>
</li>
<li>L'attribut "NEXT_HOP" reçu lors de l'échange BGP indique quel est la prochaine IP pour atteindre un réseau. L'attribut "NEXT_HOP" n'est pas mis à jour lors sa transmission via iBGP à un routeur. Ce dernier se retrouve avec un "NEXT_HOP" qui est celui du peer BGP du premier routeur et il lui faut donc un chemin pour le joindre :  <ul>
<li>Soit en injectant ce "NEXT_HOP"  dans l'IGP de l'AS (déclaration Network dans le routeur eBGP de bordure de notre AS).</li>
<li>Soit en utilisant la commande "next-hop-self" qui permet de modifier le "NEXT_HOP" avec l'adresse du routeur.</li>
</ul>
</li>
<li>La distance administrative de iBGP est de 200. </li>
</ul>
<h2 id="mp-bgp-multiprotocol-bgp">MP-BGP (multiprotocol BGP)</h2>
<ul>
<li>Protocole BGP permet de travailler avec plusieurs familles et sous familles IP.
Les notions d'"Address Family Identifier" (AFI) et de "Subsequent Address Family Identifier" (SAFI) correspondent au format des préfixes transportés:</li>
<li>Les adresses IPv4 sont identifiées en AFI =&gt; IPv4 (1) et SAFI = unicast ou multicast (1).</li>
<li>Les adresses VPN IPv4 sont identifiées en AFI = IPv4 (1), SAFI = VPN (128). Une des particularités des routes VPN est d'avoir un label associé.</li>
<li>On utilise l'attribut "Path Attributes NLRI" afin de transporter ces informations.</li>
</ul>
<h2 id="as-number-asn">AS Number (ASN)</h2>
<ul>
<li>privés: 64512-65535</li>
<li>publics: le reste ... les ASN sont assignés par le "IANA"</li>
</ul>
<h2 id="messages-bgp-echanges-sur-le-port-tcp-179">Messages BGP échangés sur le port tcp 179</h2>
<ul>
<li>OPEN (établissement de l'adjacence).</li>
<li>UPDATE (échange, retraits de routes).</li>
<li>NOTIFICATION (message d'erreurs).</li>
<li>KEEPALIVE (vérification que le "peer" est vivant toutes les 60 secondes, au bout de 180 secondes toutes les routes provenant de ce "peer" seront supprimées).</li>
</ul>
<h2 id="les-differents-etats-de-la-relation-entre-deux-voisins-bgp-neighbor-state">les différents états de la relation entre deux voisins BGP ("neighbor state")</h2>
<ul>
<li>Idle (démarrage de la session connexion au voisin)</li>
<li>Connect (après 3WayHandshake -&gt; reset -&gt; message OPEN envoyé par le routeur).</li>
<li>Active (l'autre routeur répond par un message Open vers OpenSet)</li>
<li>OpenSent (sans erreurs migration vers OpenConfirm)</li>
<li>OpenConfirm (BGP attend des messages KEEPALIVE ou NOTIFICATION)</li>
<li>Established (échange de routes via le message UPDATE)</li>
</ul>
<h2 id="interet-de-lagregation-de-prefixes-avec-bgp">Intérêt de l'agrégation de préfixes avec BGP</h2>
<ul>
<li>Afin de réduire la taille des tables de routages.</li>
<li>Améliorer la stabilité en cachant les "route flaps". </li>
</ul>
<h2 id="rfc">RFC</h2>
<ul>
<li>RFC 1105 juin 1989.</li>
<li>RFC 1654 juillet 1994.</li>
<li>RFC 2283 février 1998.</li>
</ul>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href=".." class="md-footer__link md-footer__link--prev" aria-label="Previous: Généralités BGP (texte)" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Généralités BGP (texte)
            </div>
          </div>
        </a>
      
      
        
        <a href="../bgp_cmd.html" class="md-footer__link md-footer__link--next" aria-label="Next: Commandes BGP (mindmap)" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Commandes BGP (mindmap)
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.8492ddcf.min.js"></script>
      
    
  </body>
</html>