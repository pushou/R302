
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.4.2, mkdocs-material-8.5.7" name="generator"/>
<title>BUT R302 Réseaux d'opérateurs</title>
<link href="assets/stylesheets/main.20d9efc8.min.css" rel="stylesheet"/>
<link href="assets/stylesheets/palette.cbb835fc.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<script src="js/unpkg.com/d3@6.7.0/dist/d3.min.js" type="text/javascript"></script><script src="js/unpkg.com/markmap-lib@0.14.1/dist/browser/index.min.js" type="text/javascript"></script><script src="js/unpkg.com/markmap-view@0.14.0/dist/index.min.js" type="text/javascript"></script><style type="text/css">div.mkdocs-markmap {
    width: 100%;
    min-height: 1em;
    border: 1px solid grey;
}
.mkdocs-markmap > svg {
    width: 100%;
    height: 100%;
    display: block;
}
</style></head>
<body data-md-color-accent="none" data-md-color-primary="none" data-md-color-scheme="" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="BUT R302 Réseaux d'opérateurs" class="md-header__button md-logo" data-md-component="logo" href="." title="BUT R302 Réseaux d'opérateurs">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            BUT R302 Réseaux d'opérateurs
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Généralités BGP (mindmap)
            
          </span>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="BUT R302 Réseaux d'opérateurs" class="md-nav__button md-logo" data-md-component="logo" href="." title="BUT R302 Réseaux d'opérateurs">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
    BUT R302 Réseaux d'opérateurs
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" data-md-toggle="toc" id="__toc" type="checkbox"/>
<a class="md-nav__link md-nav__link--active" href=".">
        Généralités BGP (mindmap)
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="aplat/">
        Généralités BGP (texte)
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="bgp_cmd.html">
        Commandes BGP (mindmap)
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="commandes_aplat.mm/">
        Commandes BGP (texte)
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="mplsmm/">
        Généralités MPLS (mindmap)
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="mpls_aplat.mm/">
        Généralités MPLS (texte)
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="mpls_cmd.html">
        Commandes MPLS (mindmap)
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="mpls_cmd_aplat.mm/">
        Commandes MPLS (texte)
      </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1>Généralités BGP (mindmap)</h1>
<p>BGP: généralités</p>
<div class="mkdocs-markmap" data-markdown="---&amp;#10;&amp;#10;markmap:&amp;#10;&amp;#10;  colorFreezeLevel: 2&amp;#10;&amp;#10;  maxWidth: 700&amp;#10;&amp;#10;---&amp;#10;&amp;#10;&amp;#10;&amp;#10;# BPG&amp;#10;&amp;#10;## Définitions &amp;#10;&amp;#10;&amp;#10;&amp;#10;- Un &quot;Autonomous System&quot; est un ensemble de réseaux gérés par une seule entité. Par exemple &quot;RENATER&quot; qui fédère les réseaux des universités françaises.&amp;#10;&amp;#10;- Un ISP est une entreprise dont le métier est de connecter d'autres entreprises à l'internet.&amp;#10;&amp;#10;&amp;#10;&amp;#10;    - Les &quot;ISP&quot; de tiers 1 structurent l'internet.&amp;#10;&amp;#10;    - Les &quot;tiers 2&quot; vendent et achètent du transit.&amp;#10;&amp;#10;    - Les &quot;tiers 3&quot; ne fournissent pas de transit. Ils peuvent être &quot;multi-homés&quot;(deux chemins ou plus vers l'internet) afin d'assurer la haute disponibilité des accès et avoir les chemins les plus rapides vers une ressource prisée comme un &quot;GAFAM&quot;.&amp;#10;&amp;#10;&amp;#10;&amp;#10;- Les points d'échanges sont des lieux physiques où s'interconnectent les &quot;ISP&quot; afin de faciliter les échanges de données (France XI par exemple).&amp;#10;&amp;#10;- Un &quot;Point Of Presence&quot; (&quot;POP&quot;) est un lieu physique permettant l'échange de données pour l'internet avec des entités locales.&amp;#10;&amp;#10;&amp;#10;&amp;#10;## Relations entre AS&amp;#10;&amp;#10;&amp;#10;&amp;#10;- Le &quot;transit&quot; est le service vendu par un &quot;ISP&quot; (Internet Service Provider) pour donner accès à Internet.&amp;#10;&amp;#10;- Un &quot;peer&quot; est un routeur d'un autre AS avec lequel on établit une relation de &quot;peering&quot;.&amp;#10;&amp;#10;- Le &quot;peering&quot; est l’échange réciproque de flux souvent dans un but économique (voir &lt;https://www.peeringdb.com/net/433&gt; comme exemple).&amp;#10;&amp;#10;  - Un &quot;peering&quot; n'est pas transitif : ce n'est pas parce que A à un &quot;peer&quot; avec B et avec C que C a un &quot;peer&quot; avec B.&amp;#10;&amp;#10;  - Un &quot;peering&quot; ne donne pas accès à tous les réseaux de l'&quot;AS&quot; auquel on est connecté.&amp;#10;&amp;#10;&amp;#10;&amp;#10;## Caractéristiques de BGP&amp;#10;&amp;#10;&amp;#10;&amp;#10;- La métrique de BGP est de type &quot;distance-vector&quot; et correspond au nombre d'&quot;AS&quot; traversés. L'attribut de chemins &quot;AS_PATH&quot; qui contient les AS traversés permet (mais il n'est pas le seul critère) à BGP de choisir le meilleur chemin: c'est le plus court &quot;AS-PATH&quot; qui est retenu comme chemin.&amp;#10;&amp;#10;-  BGP dispose d'un mécanisme de prévention des boucles : si un &quot;AS_PATH&quot; contient l'&quot;AS&quot; auquel appartient le routeur ce vecteur est mise de côté lors du choix de la meilleure route.&amp;#10;&amp;#10;- Il n'y a pas de paquets &quot;Hello&quot; pour l'auto-découverte des &quot;peers&quot; entre eux et donc il est nécessaire de déclarer l'IP du voisin pour communiquer.&amp;#10;&amp;#10;- Le temps de convergence de BGP est plus long que celui d'un IGP. En contrepartie, il gère des centaines de milliers de routes ce que ne peut faire un IGP.&amp;#10;&amp;#10;- Le port TCP 179 est utilisé pour les échanges entre routeurs BGP. &amp;#10;&amp;#10;- Le bit &quot;don't fragment&quot; est activé et est utilisé par le mécanisme de &quot;Path MTU&quot;.&amp;#10;&amp;#10;- BGP a besoin d'un IGP pour partager les adresses internes à l'AS. Une route par défaut ne suffit pas.&amp;#10;&amp;#10;- Deux règles pour BGP :&amp;#10;&amp;#10;   - **Principes de synchronisation** : Les routes apprises via iBGP doivent être également dans la table de routage de votre IGP (OSPF,…) avant d’être annoncées à d’autres peers d’AS différents. Cette règle a pour but de ne pas accepter de transit qu'un routeur hors du réseau iBGP ne pourrait pas router conduisant à devenir un &quot;black hole&quot;. Ce mécanisme ralentit la convergence. Les routeurs supportant dans leur immense majorité iBGP, la synchronisation est donc désactivée par défaut chez Cisco.&amp;#10;&amp;#10;   - **Split-Horizon**: une route apprise par une session iBGP n'est jamais transmise à un autre voisin iBGP afin d'éviter les boucles. On est donc obligé de faire du &quot;full-mesh&quot; entre tous les routeurs iBGP afin que ces routeurs iBGP se connaissent.&amp;#10;&amp;#10;&amp;#10;&amp;#10;- La table BGP est appelée &quot;Loc-RIB table&quot; (faire &quot;show ip bgp&quot;) et est distincte de la RIB (faire &quot;show ip route&quot;). En conséquence,  il faut vérifier les deux tables : si la route exacte n'existe pas dans la &quot;RIB BGP&quot; ne transmettra pas la route à un autre AS &amp;#10;&amp;#10;- Les routes apprises dans iBGP sont redistribuées dans eBGP et vice-versa. Mais il n'y a pas de redistribution des routes d'un routeur iBGP vers un routeur iBGP.&amp;#10;&amp;#10;&amp;#10;&amp;#10;## Sessions&amp;#10;&amp;#10;&amp;#10;&amp;#10;- eBGP&amp;#10;&amp;#10;  - C'est une session BGP entre deux routeurs appartenant à des AS différents.&amp;#10;&amp;#10;  - Le TTL du paquet BGP est de 1 (le routeur averti doit être en frontal du nôtre et donc à une distance de 1 suffit et sécurise les échanges)&amp;#10;&amp;#10;  - Le routeur averti vérifie que son AS n'est pas dans l'&quot;AS_PATH&quot; reçu. &amp;#10;&amp;#10;  - Le routeur averti positionne le &quot;NEXT-HOP&quot; pour cette AS à l'IP source du routeur source établissant la connexion.&amp;#10;&amp;#10;  - Le routeur averti ajoute son ASN dans l'&quot;AS_PATH&quot;.&amp;#10;&amp;#10;  - La distance administrative est de 20 pour BGP.&amp;#10;&amp;#10;&amp;#10;&amp;#10;- iBGP &amp;#10;&amp;#10;  - Il est fait pour communiquer entre routeurs BGP dans un même AS (TTL des paquets à 255).&amp;#10;&amp;#10;  - L'attribut AS_PATH n'est pas modifié par iBGP, il n'y a donc pas de détection possible des boucles avec iBGP.&amp;#10;&amp;#10;  - Dans le cas d'un AS de transit les routeurs traversés qui n'implémentent qu'un IGP ne connaissent &amp;#10;&amp;#10;    pas les routes issues de BGP. Il faut donc soit des routes statiques, soit du &quot;tunelling&quot; MPLS, soit du fullmesh iBGP (&quot;route reflector&quot;), soit redistribuer les routes BGP dans l'IGP mais ...&amp;#10;&amp;#10;    - Il n'est pas conseiller de redistribuer les routes BGP dans l'IGP : il peut y avoir beaucoup de routes BGP...trop pour un IGP qui n'est pas taillé pour cela. Il n'y a pas non plus d'équivalence des métriques IGP ni de traductions possibles des attributs BGP dans le &quot;langage&quot; de l'IGP. &amp;#10;&amp;#10;    - La redistribution des routes de l'IGP dans BGP n'est pas souhaitable non plus : il vaut mieux que tous les routeurs internes à l'AS supportent iBGP avec une topologie &quot;full mesh&quot; qui peut être facilitée par un &quot;RR&quot; (réflecteur de route).&amp;#10;&amp;#10;  - L'attribut &quot;NEXT_HOP&quot; reçu lors de l'échange BGP indique quel est la prochaine IP pour atteindre un réseau. L'attribut &quot;NEXT_HOP&quot; n'est pas mis à jour lors sa transmission via iBGP à un routeur. Ce dernier se retrouve avec un &quot;NEXT_HOP&quot; qui est celui du peer BGP du premier routeur et il lui faut donc un chemin pour le joindre :  &amp;#10;&amp;#10;     - Soit en injectant ce &quot;NEXT_HOP&quot;  dans l'IGP de l'AS (déclaration Network dans le routeur eBGP de bordure de notre AS).&amp;#10;&amp;#10;     - Soit en utilisant la commande &quot;next-hop-self&quot; qui permet de modifier le &quot;NEXT_HOP&quot; avec l'adresse du routeur.&amp;#10;&amp;#10;  - La distance administrative de iBGP est de 200. &amp;#10;&amp;#10;&amp;#10;&amp;#10;## MP-BGP (multiprotocol BGP)&amp;#10;&amp;#10;&amp;#10;&amp;#10;- Protocole BGP permet de travailler avec plusieurs familles et sous familles IP.&amp;#10;&amp;#10;Les notions d'&quot;Address Family Identifier&quot; (AFI) et de &quot;Subsequent Address Family Identifier&quot; (SAFI) correspondent au format des préfixes transportés:&amp;#10;&amp;#10;  - Les adresses IPv4 sont identifiées en AFI =&gt; IPv4 (1) et SAFI = unicast ou multicast (1).&amp;#10;&amp;#10;  - Les adresses VPN IPv4 sont identifiées en AFI = IPv4 (1), SAFI = VPN (128). Une des particularités des routes VPN est d'avoir un label associé.&amp;#10;&amp;#10;- On utilise l'attribut &quot;Path Attributes NLRI&quot; afin de transporter ces informations.&amp;#10;&amp;#10;&amp;#10;&amp;#10;## AS Number (ASN)&amp;#10;&amp;#10;&amp;#10;&amp;#10;- privés: 64512-65535&amp;#10;&amp;#10;- publics: le reste ... les ASN sont assignés par le &quot;IANA&quot;&amp;#10;&amp;#10;&amp;#10;&amp;#10;## Messages BGP échangés sur le port tcp 179&amp;#10;&amp;#10;&amp;#10;&amp;#10;- OPEN (établissement de l'adjacence).&amp;#10;&amp;#10;- UPDATE (échange, retraits de routes).&amp;#10;&amp;#10;- NOTIFICATION (message d'erreurs).&amp;#10;&amp;#10;- KEEPALIVE (vérification que le &quot;peer&quot; est vivant toutes les 60 secondes, au bout de 180 secondes toutes les routes provenant de ce &quot;peer&quot; seront supprimées).&amp;#10;&amp;#10;&amp;#10;&amp;#10;## les différents états de la relation entre deux voisins BGP (&quot;neighbor state&quot;)&amp;#10;&amp;#10;&amp;#10;&amp;#10;- Idle (démarrage de la session connexion au voisin)&amp;#10;&amp;#10;- Connect (après 3WayHandshake -&gt; reset -&gt; message OPEN envoyé par le routeur).&amp;#10;&amp;#10;- Active (l'autre routeur répond par un message Open vers OpenSet)&amp;#10;&amp;#10;- OpenSent (sans erreurs migration vers OpenConfirm)&amp;#10;&amp;#10;- OpenConfirm (BGP attend des messages KEEPALIVE ou NOTIFICATION)&amp;#10;&amp;#10;- Established (échange de routes via le message UPDATE)&amp;#10;&amp;#10;&amp;#10;&amp;#10;## Intérêt de l'agrégation de préfixes avec BGP&amp;#10;&amp;#10;&amp;#10;&amp;#10;- Afin de réduire la taille des tables de routages.&amp;#10;&amp;#10;- Améliorer la stabilité en cachant les &quot;route flaps&quot;. &amp;#10;&amp;#10;&amp;#10;&amp;#10;## RFC&amp;#10;&amp;#10;&amp;#10;&amp;#10;- RFC 1105 juin 1989.&amp;#10;&amp;#10;- RFC 1654 juillet 1994.&amp;#10;&amp;#10;- RFC 2283 février 1998.&amp;#10;&amp;#10;&amp;#10;&amp;#10;"><svg class="markmap" id="markmap-0"></svg></div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<nav aria-label="Footer" class="md-footer__inner md-grid">
<a aria-label="Next: Généralités BGP (texte)" class="md-footer__link md-footer__link--next" href="aplat/" rel="next">
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                Next
              </span>
              Généralités BGP (texte)
            </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": ".", "features": [], "search": "assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
<script src="assets/javascripts/bundle.8492ddcf.min.js"></script>
<script type="text/javascript">(function initializeMarkmap() {
    function update_markmaps() {
        const markmap_transformer = new markmap.Transformer();
        const markmaps = document.getElementsByClassName('mkdocs-markmap');
        var el, content, svg, root, m;
        for (var i = 0; i < markmaps.length; i++) {
            el = markmaps[i];
            content = el.getAttribute('data-markdown').replaceAll('&#10;', '\n');
            svg = el.querySelector('svg');
            root = markmap_transformer.transform(content).root;
            m = markmap.Markmap.create(svg, null, root);

            (function(obj, e, r) {
                obj.rescale(1).then(function() {
                    e.parentElement.style.height = (e.getBBox().height + 10) + "px";
                    requestAnimationFrame(() => { obj.fit(); })
                });
            })(m, svg, root);
        }
    }

    var MutationObserver = window.MutationObserver || window.WebKitMutationObserver;
    var observer = new MutationObserver(function(mutations) {
        update_markmaps();
    });

    var target = document.getElementById('mkdocs-decrypted-content');
    if (undefined != target) {
        observer.observe(target, { childList: true });
    }

    update_markmaps();
})();
</script></body>
</html>