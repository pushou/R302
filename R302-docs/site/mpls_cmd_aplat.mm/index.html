
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-8.5.7">
    
    
      
        <title>Commandes MPLS (texte) - BUT R302 Réseaux d'opérateurs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.20d9efc8.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#commandes-linux-aslabel" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="BUT R302 Réseaux d&#39;opérateurs" class="md-header__button md-logo" aria-label="BUT R302 Réseaux d'opérateurs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            BUT R302 Réseaux d'opérateurs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Commandes MPLS (texte)
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="BUT R302 Réseaux d&#39;opérateurs" class="md-nav__button md-logo" aria-label="BUT R302 Réseaux d'opérateurs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    BUT R302 Réseaux d'opérateurs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Généralités BGP (mindmap)
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../aplat/" class="md-nav__link">
        Généralités BGP (texte)
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../bgp_cmd.html" class="md-nav__link">
        Commandes BGP (mindmap)
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../commandes_aplat.mm/" class="md-nav__link">
        Commandes BGP (texte)
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../mplsmm/" class="md-nav__link">
        Généralités MPLS (mindmap)
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../mpls_aplat.mm/" class="md-nav__link">
        Généralités MPLS (texte)
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../mpls_cmd.html" class="md-nav__link">
        Commandes MPLS (mindmap)
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Commandes MPLS (texte)
      </a>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="commandes-linux-aslabel">Commandes Linux (AS+LABEL)</h1>
<ul>
<li>mtr</li>
</ul>
<pre><code class="language-bash">  mtr --tcp --port 443 --show-ips --mpls --aslookup --curses www.umontpellier.fr
  mtr -P 443 -T  -b -e -z -t 194.199.227.220
  mtr  -P 443 -T -c 2  -b -e -z -t -j 194.199.227.220 | from json|flatten|get hubs|flatten
</code></pre>
<ul>
<li>traceroute</li>
</ul>
<pre><code class="language-bash">traceroute -A -n -e -i eth0 8.8.8.8
</code></pre>
<h1 id="commandes-cisco">Commandes Cisco</h1>
<h2 id="mpls-config">mpls config</h2>
<ul>
<li><code>ios
  # cef améliore les performances de MPLS(distributed c'est mieux) 
  conf t
     ip cef distributed</code></li>
<li>
<p>AutoConfig LDP
  <code>ios
  router ospf 1
      mpls ldp autoconfig</code></p>
</li>
<li>
<p>Déclarer l'usage de MPLS sur une interface</p>
</li>
</ul>
<pre><code class="language-ios">  interface FastEthernet2/0
         mpls ip

  ```

## Configuration d'un provider (=LSR) L3VPN

```ios
interface Loopback2
 ip address 2.2.2.2 255.255.255.255
!
interface FastEthernet0/0
 ip address 10.0.12.2 255.255.255.252
 duplex auto
 speed auto
 mpls ip
!
interface FastEthernet1/0
 ip address 10.0.23.2 255.255.255.252
 duplex auto
 speed auto
 mpls ip
!
interface FastEthernet2/0
 ip address 10.0.24.2 255.255.255.252
 duplex auto
 speed auto
 mpls ip
!
router ospf 1
 router-id 2.2.2.2
 log-adjacency-changes
 network 2.2.2.0 0.0.0.255 area 0
 network 10.0.12.0 0.0.0.3 area 0
 network 10.0.23.0 0.0.0.3 area 0
 network 10.0.24.0 0.0.0.3 area 0
 network 0.0.0.0 255.255.255.255 area 0
!
</code></pre>
<h2 id="configuration-dun-pe-ler-l3vpn">Configuration d'un PE (=LER) L3VPN</h2>
<pre><code class="language-ios">interface Loopback3
 ip address 3.3.3.3 255.255.255.255
!
interface FastEthernet0/0
 ip address 10.0.23.1 255.255.255.252
 duplex auto
 speed auto
 mpls ip
!
interface FastEthernet1/0
 ip vrf forwarding custA
 ip address 192.168.3.3 255.255.255.0
 duplex auto
 speed auto
!         
interface FastEthernet2/0
 ip vrf forwarding custC
 ip address 192.168.3.3 255.255.255.0
 duplex auto
 speed auto
!
router eigrp 1
 no auto-summary
 !
 address-family ipv4 vrf custA
  redistribute bgp 200
  network 3.3.3.0 0.0.0.255
  network 192.168.3.0
  default-metric 10000 100 255 1 1500
  auto-summary
  autonomous-system 10
 exit-address-family
!
router ospf 2 vrf custC
 log-adjacency-changes
 redistribute bgp 200 metric 200 subnets
 network 3.3.3.0 0.0.0.255 area 0
 network 192.168.3.0 0.0.0.255 area 0
!
router ospf 1
 router-id 3.3.3.3
 log-adjacency-changes
 network 3.3.3.0 0.0.0.255 area 0
 network 10.0.23.0 0.0.0.3 area 0
!
router bgp 200
 no bgp default ipv4-unicast
 bgp log-neighbor-changes
 neighbor 1.1.1.1 remote-as 200
 neighbor 1.1.1.1 update-source Loopback3
 neighbor 4.4.4.4 remote-as 200
 neighbor 4.4.4.4 update-source Loopback3
 !
 address-family ipv4
  neighbor 1.1.1.1 activate
  neighbor 4.4.4.4 activate
  no auto-summary
  no synchronization
 exit-address-family
 !
 address-family vpnv4
  neighbor 1.1.1.1 activate
  neighbor 1.1.1.1 send-community extended
  neighbor 4.4.4.4 activate
  neighbor 4.4.4.4 send-community extended
 exit-address-family
 !
 address-family ipv4 vrf custC
  redistribute ospf 2 vrf custC
  no synchronization
 exit-address-family
 !
 address-family ipv4 vrf custA
  redistribute eigrp 10
  no synchronization
 exit-address-family
!
</code></pre>
<h2 id="debug-mpls">Debug mpls</h2>
<pre><code class="language-ios">  sh mpls forwarding-table  
  Local  Outgoing    Prefix            Bytes tag  Outgoing   Next Hop    
  tag    tag or VC   or Tunnel Id      switched   interface              
  16     Pop tag     10.0.24.0/30      0          Fa2/0      10.0.12.2    
  17     Pop tag     10.0.23.0/30      0          Fa2/0      10.0.12.2    
  18     Pop tag     2.2.2.2/32        0          Fa2/0      10.0.12.2    
  19     16          3.3.3.3/32        0          Fa2/0      10.0.12.2    
  20     17          4.4.4.4/32        0          Fa2/0      10.0.12.2    
  21     Untagged    5.0.0.0/8[V]      0          Fa1/0      192.168.1.5  
  22     Aggregate   192.168.1.0/24[V] 0                                  
  23     Untagged    6.0.0.0/8[V]      0          Fa3/0      192.168.1.6  
  24     Aggregate   192.168.1.0/24[V] 0                                  
  25     Untagged    11.11.11.11/32[V] 0          Fa0/0      192.168.1.11 
  26     Aggregate   192.168.1.0/24[V] 0    
</code></pre>
<pre><code class="language-ios">show tag-switching tdp neighbor 
  Peer LDP Ident: 2.2.2.2:0; Local LDP Ident 1.1.1.1:0
    TCP connection: 2.2.2.2.62837 - 1.1.1.1.646
    State: Oper; Msgs sent/rcvd: 141/142; Downstream
    Up time: 01:55:58
    LDP discovery sources:
     FastEthernet2/0, Src IP addr: 10.0.12.2
        Addresses bound to peer LDP Ident:
          10.0.12.2       2.2.2.2         10.0.23.2       10.0.24.2     
  ```

```ios
sh bgp vpnv4 unicast all summary 
  BGP router identifier 1.1.1.1, local AS number 200
  BGP table version is 33, main routing table version 33
  15 network entries using 2055 bytes of memory
  20 path entries using 1360 bytes of memory
  17/14 BGP path/bestpath attribute entries using 2108 bytes of memory
  7 BGP extended community entries using 360 bytes of memory
  0 BGP route-map cache entries using 0 bytes of memory
  0 BGP filter-list cache entries using 0 bytes of memory
  BGP using 5883 total bytes of memory
  BGP activity 15/0 prefixes, 22/2 paths, scan interval 15 secs

  Neighbor        V    AS MsgRcvd MsgSent   TblVer  InQ OutQ Up/Down  State/PfxRcd
  3.3.3.3         4   200      71      73       33    0    0  00:58:42        7
  4.4.4.4         4   200      71      74       33    0    0  00:58:39        7

</code></pre>
<p>### Vérifiez la correspondance label-fec
  <code>ios
  R1#show tag-switching tdp neighbor 
    Peer LDP Ident: 2.2.2.2:0; Local LDP Ident 1.1.1.1:0
     TCP connection: 2.2.2.2.62837 - 1.1.1.1.646
     State: Oper; Msgs sent/rcvd: 141/142; Downstream
     Up time: 01:55:58
    LDP discovery sources:
     FastEthernet2/0, Src IP addr: 10.0.12.2
        Addresses bound to peer LDP Ident:
          10.0.12.2       2.2.2.2         10.0.23.2       10.0.24.2</code></p>
<h3 id="verifiez-la-forwarding-table">Vérifiez la forwarding table</h3>
<p>```ios</p>
<p>show tag-switching forwarding-table 
  Local  Outgoing    Prefix            Bytes tag  Outgoing   Next Hop  <br/>
  tag    tag or VC   or Tunnel Id      switched   interface            <br/>
  16     Pop tag     10.0.24.0/30      0          Fa0/0      10.0.23.2  <br/>
  17     Pop tag     2.2.2.2/32        0          Fa0/0      10.0.23.2  <br/>
  18     17          4.4.4.4/32        0          Fa0/0      10.0.23.2  <br/>
  19     Pop tag     10.0.12.0/30      0          Fa0/0      10.0.23.2  <br/>
  20     18          1.1.1.1/32        0          Fa0/0      10.0.23.2  <br/>
  21     Untagged    7.0.0.0/8[V]      0          Fa1/0      192.168.3.7<br/>
  22     Aggregate   192.168.3.0/24[V] 0                                <br/>
  23     Untagged    9.9.9.9/32[V]     0          Fa2/0      192.168.3.9<br/>
  24     Untagged    10.10.10.10/32[V] 0          Fa2/0      192.168.3.9<br/>
  25     Aggregate   192.168.3.0/24[V] 0                                <br/>
  26     Untagged    192.168.4.0/24[V] 0          Fa2/0      192.168.3.9<br/>
  27     Untagged    192.168.90.0/24[V]0          Fa2/0      192.168.3.9   <br/>
  ```</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../mpls_cmd.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Commandes MPLS (mindmap)" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Commandes MPLS (mindmap)
            </div>
          </div>
        </a>
      
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.8492ddcf.min.js"></script>
      
    
  </body>
</html>